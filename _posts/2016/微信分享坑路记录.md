# 微信分享坑路记录

最近做了一个微信推广推广页面，遇到不少问题，主要集中在它的签名验证环节。

<!--more-->

注意点一：

首先所有微信的服务都需要签名验证。分享的所有接口都需要初始化验证

注意点二：

所有签名的需要的参数都必须在服务器生成，**需要后端小哥的配合**，即便微信那一系列接口看上去都是前端的工作。

注意点三：

需要有一个微信认证过公众号，而且坑的一点是个人的公众号是无法进行微信认证的。还好微信有个微信测试账号了供我们测试开发。

还需要注意，和Android和IOS的的sdk不同，jssdk必须需要公众号的appid和secretKey的，而app开发需要的是微信开发者平台创建的应用的appid和secretKey。我开发中很多人不明白这点区别讨论了很久。

微信公众号需要在公众号设置 - 功能设置中设置js接口安全域名，绑定的域名必须为顶级域名（就是xxx.com|net|...形式的域名，不带www）。并且要求是通过**备案**的域名。估计是为了好追溯微信内转发信息的来源吧。

注意点四：

签名很难成功，如果你像我一样悲催。首先先和后端效果将微信的[常见错误及解决方法][]都过一遍吧。然后我还遇到了一些问题，可能并不那么具有普遍性，仅供参考。

- 微信jssdk的引入需要和你推广页的协议匹配，https的页面需要引入https对应的库文件。我用了//开头的协议，让浏览器自己去选择引用的协议，结果悲剧了。。
- 调试很麻烦，如果你们没有一个测试环境的话。。，如果你们服务器签名服务和你推广页的页面都放在同一个域名下的话可以参考下面我的解决方案。

> 我是通过nginx代理解决的。准备一个安装了nginx的虚拟机。在开发机器上讲你的虚拟机的ip映射成你的产品环境域名。将你的推广页放到nginx的页面目录，然后更改nginx的配置，将签名的路径指向真正签名的路径。
>```nginx
>location /你的签名地址 {
> proxy_pass 你产品环境的根url
>}
>```

本文章仅仅是个人总结学习之用，最后推荐一个[微信的调试工具](https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html), 下载地址是 <https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html#.E4.B8.8B.E8.BD.BD.E5.9C.B0.E5.9D.80>

[常见错误及解决方法]:http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E9.99.84.E5.BD.955-.E5.B8.B8.E8.A7.81.E9.94.99.E8.AF.AF.E5.8F.8A.E8.A7.A3.E5.86.B3.E6.96.B9.E6.B3.95


